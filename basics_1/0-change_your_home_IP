#!/usr/bin/env bash
# This script updates /etc/hosts to resolve localhost to 127.0.0.2 and facebook.com to 8.8.8.8

set -euo pipefail

HOSTS_FILE="/etc/hosts"

# Create a backup of the hosts file
sudo cp "$HOSTS_FILE" "${HOSTS_FILE}.bak"

# Replace or add localhost with 127.0.0.2
if grep -qE '^\s*127\.0\.0\.1\s+localhost\b' "$HOSTS_FILE"; then
    sudo sed -i 's/^\s*127\.0\.0\.1\s\+localhost\b/127.0.0.2 localhost/' "$HOSTS_FILE"
else
    echo "127.0.0.2 localhost" | sudo tee -a "$HOSTS_FILE" > /dev/null
fi

# Add facebook.com with 8.8.8.8 if not present
if grep -qE '\bfacebook\.com\b' "$HOSTS_FILE"; then
    sudo sed -i 's/^.*\bfacebook\.com\b.*/8.8.8.8 facebook.com/' "$HOSTS_FILE"
else
    echo "8.8.8.8 facebook.com" | sudo tee -a "$HOSTS_FILE" > /dev/null
fi
